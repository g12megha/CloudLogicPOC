'use strict';

var http = require('http');
var parameters = require('commander');
var configuration = require('./configuration');
var loggerUtil = require('./lib/utils/logger');
var WsProxy = require('./lib/websockets/WsProxy');

var logger = loggerUtil.getLogger('/approuter');

logger.info('Application router version %s', require('./package.json').version);

parameters
  .option('-w --workingDir <s>', 'The working directory containting the resources folder and xs-app.json file')
  .option('-p, --port <n>', 'The Port of the approuter')
  .parse(process.argv);

var approuter = configuration(parameters);
var httpServer = http.createServer(approuter);

if (approuter.get('routerConfig').appConfig.websockets.enabled) {
  var wsServer = new WsProxy(approuter);
  wsServer.listen(httpServer);
}

httpServer.listen(approuter.get('routerConfig').serverPort, function () {
  logger.info('Applicaiton router is listening on port: ' + httpServer.address().port);
});
