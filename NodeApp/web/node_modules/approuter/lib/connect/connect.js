'use strict';
var connect = require('connect');
var querystring = require('querystring');
var url = require('url');

module.exports = function () {
  var app = connect();
  app._store = {};
  app.set = function (key, value) {
    app._store[key] = value;
  };
  app.get = function (key) {
    return app._store[key];
  };

  app.use(function (req, res, next) {
    req.app = app;
    req.protocol = req.connection.encrypted ? 'https' : 'http';
    req.query = querystring.parse(url.parse(req.url).query || ''); // needed by passport-oauth
    next();
  });
  return app;
};
