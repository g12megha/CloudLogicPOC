'use strict';

var _ = require('lodash');
var cookieModule = require('cookie');

var serializeCookies = function (cookies) {
  var cookieNames = Object.keys(cookies);
  if (cookieNames.length === 0) {
    return null;
  }

  return cookieNames.map(function (name) {
    return cookieModule.serialize(name, cookies[name]);
  }).join('; ');
};

module.exports = function stripCookie(req, cookieName) {
  if (!req.headers.cookie) {
    return;
  }

  var cookiesMap = cookieModule.parse(req.headers.cookie);
  cookiesMap = _.omit(cookiesMap, cookieName);

  req.headers.cookie = serializeCookies(cookiesMap);
  if (req.headers.cookie === null) {
    delete req.headers.cookie;
  }
};
