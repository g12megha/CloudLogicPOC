'use strict';

var OAuth2Strategy = require('sap-passport-oauth2');
var BasicOAuth2Strategy = require('./basic-oauth2-strategy.js');
var utils = require('./utils');

module.exports = {
  getUserSerializer: function (user, callback) {
    if (user && user.name) {
      callback(null, JSON.stringify(user));
    } else {
      callback('No user name found');
    }
  },

  getUserDeserializer: function (sUser, callback) {
    if (sUser === '') {
      callback(null, {});
    } else {
      var user = JSON.parse(sUser);
      if (user) {
        callback(null, user);
      } else {
        callback('User not found ' + sUser);
      }
    }
  },

  getXSUAAOauthStrategy: function (req, localServiceConfig, cfEnvFromFile) {
    var options = utils.loadOauthOptions(req, localServiceConfig, cfEnvFromFile);

    if (options.authorizationURL && options.tokenURL && options.clientID && options.clientSecret) {
      var oAuth2Strategy = new OAuth2Strategy(options, utils.storeToken);
      return oAuth2Strategy;
    }
  },

  getBasicOauthStrategy: function (req, username, password, localServiceConfig, cfEnvFromFile) {
    var options = utils.loadOauthOptions(req, localServiceConfig, cfEnvFromFile);
    options.username = username;
    options.password = password;

    if (options.authorizationURL && options.tokenURL && options.clientID && options.clientSecret) {
      var oAuth2Strategy = new BasicOAuth2Strategy(options, utils.storeToken);
      return oAuth2Strategy;
    }
  }
};
