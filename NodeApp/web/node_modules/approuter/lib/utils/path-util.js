'use strict';

var url = require('url');

module.exports = {
  isPublicPath: function (req, appConfig) {
    if (appConfig && appConfig.authenticationMethod === 'none') {
      return true;
    }

    var path = module.exports.getRequestPath(req);
    if (path === appConfig.login.callbackEndpoint) {
      return true;
    }

    var internalUrl = req.internalUrl;
    if (internalUrl && internalUrl.route.authenticationType === 'none') {
      return true;
    }

    return false;
  },

  isBasicAuthProtectedPath: function (req) {
    return this.pathAuthenticationType(req) === 'basic';
  },

  pathAuthenticationType: function (req) {
    if (req.internalUrl && req.internalUrl.route &&
      req.internalUrl.route.authenticationType) {
      return req.internalUrl.route.authenticationType.toLowerCase();
    }
    return 'xsuaa';
  },

  getRequestPath: function (req) {
    if (req.internalUrl) {
      return req.internalUrl.pathname;
    }
    return url.parse(req.url).pathname;
  }
};
